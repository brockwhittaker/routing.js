var RouteConfig=function(t){"use strict";var e={script:null,routes:{},config:{cache:!0},container:null,copy:null,view:{current:null,old:null},animation:{inProgress:!1},observer:null},n={};n.ajax=function(t,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?n.success(o.responseText):400==o.status?n.error(o.responseText,{error:400}):n.error(o.responseText,{error:"unknown"}))},e.config.cache===!1&&(t+="?t="+(new Date).getTime()),o.open("GET",t,!0),o.send()},n.config=function(t){for(var n in t)t.hasOwnProperty(n)&&"undefined"!=typeof e.config[n]?e.config[n]=t[n]:console.warn("Warning. Cannot set new property '"+n+"' to config.");return o},n.controller={scope:function(t){var n=e.routes[e.view.current].state;t(n,n.data,e.container)}},n.hash={"public":{get:function(){var t=window.location.hash.substr(2),e=t.match(/^[\w_-]+/),n=t.replace(/^[\w_-]+\?{0,}/,""),o={};return n.length>0&&(n=n.split(/&/g).map(function(t){return t.split(/=/g)}),o={},n.forEach(function(t){o[t[0]]=t[1]})),!!e&&{view:e[0],get:o}},set:{view:function(t){var e=n.hash["public"].get(),r=n.hash["private"].concatGet(e.get);return e?window.location.hash="/"+t+(r?"?"+r:""):window.location.hash="/"+t,o},get:function(t){var e=n.hash["public"].get(),r=n.hash["private"].concatGet(t);if(!e)throw"Error. No view currently set.";return window.location.hash="/"+e.view+(r?"?"+r:""),o}}},"private":{concatGet:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push([n,t[n]]);return e.map(function(t){return t.join("=")}).join("&")}}},n.init=function(){window.onhashchange=function(){var t=this.hash["public"].get();this.view["new"](t.view)}.bind(this),e.container="string"==typeof t?document.querySelectorAll(t)[0]:t,this.mutation.addEvents()},n.load={html:function(t,e){n.ajax(t,{success:function(t){e(t)},error:function(t,n){throw e(t),n}})},script:function(t,n){e.script&&document.body.removeChild(e.script),e.script=document.createElement("script"),e.script.onload=function(){n()},e.script.src=t,document.body.appendChild(e.script)},page:function(t,n){var o={html:!1,script:!1},r=function(){this.script(t.url.script,function(){o.script=!0,n()})}.bind(this);t.content.html&&e.config.cache?(o.html=!0,e.container.innerHTML=t.content.html,r()):this.html(t.url.html,function(n){o.html=!0,t.content.html=n,e.container.innerHTML=t.content.html,r()})}},n.mutation={observe:function(t){e.observer=new MutationObserver(function(e){e.forEach(function(e){"childList"==e.type&&t(e)})});var n={attributes:!0,childList:!0,characterData:!0};e.observer.observe(e.container,n)},addEventsToNode:function(t){var o=["click","input","mousemove"],r=e.routes[e.view.current].state,i=function(){};if(1===t.nodeType&&t.hasAttribute("b-name")){var a=t.getAttribute("b-events"),c=t.getAttribute("b-name");n.util.createScopeKey(r,c),r[c].self.push(t),a&&a.split(/,/).forEach(function(e){r[c][e]=r[c][e]||i,t.addEventListener(e,function(t){r[c][e].call(this,t)})}),o.forEach(function(e){var n=t.getAttribute("b-"+e);n&&t.addEventListener(e,function(t){"function"==typeof r[n]&&r[n].call(this,t)})})}},removeNode:function(t){if(1===t.nodeType&&t.hasAttribute("b-name")){var o=t.getAttribute("b-name"),r=e.routes[e.view.current].state,i=r[o]||e.routes[e.view.old].state[o];n.util.mutable(i,"self"),i.self=i.self.filter(function(e){return!t.isSameNode(e)}),n.util.immutable(i,"self")}},addEvents:function(t){var e=this;this.observe(function(t){var n,o=t.addedNodes,r=t.removedNodes;for(n=0;n<r.length;n++)e.removeNode(r[n]);for(n=0;n<o.length;n++)e.addEventsToNode(o[n])})}},n.routes={add:function(t,r,i){if(e.routes[t])throw"Error. Route with the name '"+t+"' already exists.";e.routes[t]={name:t,url:{html:r,script:i},content:{html:null},state:{}};var a=e.routes[t].state;return n.util.createScope(a,e.routes),o},deploy:function(t,r){var i=e.routes[t];if(!i)throw"Error. Route with the name '"+t+"' does not exist.";return n.hash["public"].set.view(t),n.load.page(i,function(e){console.log("loaded route '"+t+"'!"),r&&r()}),o}},n.transition={clonePage:function(){e.copy&&(e.copy.parentNode.removeChild(e.copy),e.copy=null),e.copy=e.container.cloneNode(!0),e.copy.id="",e.copy.className=""},applyStyling:function(){},hideContainer:function(){e.container.style.display="none"},appendCopy:function(){var t=e.container.parentNode;t.insertBefore(e.copy,e.container.nextSibling)},callback:{set:function(t){e.transition=t},after:function(){e.copy&&(e.copy.parentNode.removeChild(e.copy),e.copy=null),"none"==e.container.style.display&&(e.container.style.display="block"),e.animation.inProgress=!1}},before:function(t){this.clonePage(),this.hideContainer(),this.appendCopy()}},n.util={immutable:function(t,e,n){var o={writable:!1,configurable:!0};return n&&(o.value=n),Object.defineProperty(t,e,o),this},mutable:function(t,e){Object.defineProperty(t,e,{writable:!0})},createScopeKey:function(t,e){var o=n.util.immutable;t[e]||(t[e]={},o(t[e],"data",{}),o(t[e],"self",[]))},createScope:function(t,o){var r=n.util.immutable;r(t,"data",{}),r(t,"event",{}),r(t.event,"add",function(t,e,n){if(this[t]||(this[t]={}),"object"==typeof e)for(var o in e)this[t][o]=e[o];else this[t][e]=n}.bind(t)),r(t,"get",function(e){return t[e]?t[e]:(n.util.createScopeKey(t,e),console.warn("Error. This property with name '"+e+"' doesn't exist yet."),t[e])}),r(t.data,"prop",function(e,o,r){return t[e]||n.util.createScopeKey(t,e),t[e].data[o]=r,t[e].data[o]}),r(t.data,"transfer",function(n,o){var r=t.data[n];if("undefined"==typeof r||null===r)throw"Error. Data associated with key '"+n+"' does not exist.";if(!e.routes[o])throw"Error. View with the name '"+name+"' does not exist.";e.routes[o].state.data[n]=r})}},n.view={"new":function(t){t!==e.view.current&&null!==e.view.current&&e.routes[t]?(e.view.old=e.view.current,e.view.current=t,e.animation.inProgress=!0,n.hash["public"].set.view(t),n.transition.before(),n.routes.deploy(t,function(){e.transition?e.transition.call(null,n.transition.callback.after,{old:e.copy,"new":e.container},{"new":e.view.current,old:e.view.old}):n.transition.callback.after()})):t!==e.view.current&&e.routes[t]?(e.view.old=e.view.current,e.view.current=t,e.animation.inProgress=!0,n.routes.deploy(t,function(){n.transition.callback.after()})):e.routes[t]?t===e.view.current:console.warn("Error. The route '"+t+"' does not exist.")}},n.init();var o={add:n.routes.add,deploy:n.view["new"],config:n.config,hash:n.hash["public"],transition:n.transition.callback.set,controller:n.controller.scope};return o};