var funcs={};funcs.ajax=function(t,n,e){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?n.success(o.responseText):400==o.status?n.error(o.responseText,{error:400}):n.error(o.responseText,{error:"unknown"}))},e===!1&&(t+="?t="+(new Date).getTime()),o.open("GET",t,!0),o.send()},funcs.config=function(t,n){for(var e in t)t.hasOwnProperty(e)&&"undefined"!=typeof n.config[e]?n.config[e]=t[e]:console.warn("Warning. Cannot set new property '"+e+"' to config.");return this.proto},funcs.controller={scope:function(t,n){var e=n.routes[n.view.current].state;t(e,e.data,n.container)}},funcs.hash={"public":{get:function(){var t=window.location.hash.substr(2),n=t.match(/^[\w_-]+/),e=t.replace(/^[\w_-]+\?{0,}/,""),o={};return e.length>0&&(e=e.split(/&/g).map(function(t){return t.split(/=/g)}),o={},e.forEach(function(t){o[t[0]]=t[1]})),!!n&&{view:n[0],get:o}},set:{view:function(t){var n=funcs.hash["public"].get(),e=funcs.hash["private"].concatGet(n.get);n?window.location.hash="/"+t+(e?"?"+e:""):window.location.hash="/"+t},get:function(t){var n=funcs.hash["public"].get(),e=funcs.hash["private"].concatGet(t);if(!n)throw"Error. No view currently set.";window.location.hash="/"+n.view+(e?"?"+e:"")}}},"private":{concatGet:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push([e,t[e]]);return n.map(function(t){return t.join("=")}).join("&")}}},funcs.init=function(t,n){window.onhashchange=function(){var n=this.hash["public"].get();this.view["new"](n.view,t)}.bind(this),t.container="string"==typeof n?document.querySelectorAll(n)[0]:n,this.mutation.addEvents(t)},funcs.load={html:function(t,n,e){funcs.ajax(t,{success:function(t){n(t)},error:function(t,e){throw n(t),e}},e)},script:function(t,n,e){t.script&&document.body.removeChild(t.script),t.script=document.createElement("script"),t.script.onload=function(){e()},t.script.src=n,document.body.appendChild(t.script)},page:function(t,n,e){var o={html:!1,script:!1},r=function(){this.script(t,n.url.script,function(){o.script=!0,e()})}.bind(this);n.content.html&&t.config.cache?(o.html=!0,t.container.innerHTML=n.content.html,r()):this.html(n.url.html,function(e){o.html=!0,n.content.html=e,t.container.innerHTML=n.content.html,r()},t.config.cache)}},funcs.mutation={observe:function(t,n){var e=new MutationObserver(function(t){t.forEach(function(t){"childList"==t.type&&n(t)})}),o={attributes:!0,childList:!0,characterData:!0};return e.observe(t.container,o),e},addEventsToNode:function(t,n){var e=["click","input","mousemove"],o=function(){};if(1===n.nodeType&&n.hasAttribute("b-name")){var r=n.getAttribute("b-events"),i=n.getAttribute("b-name");funcs.util.createScopeKey(t,i),t[i].self.push(n),r&&r.split(/,/).forEach(function(e){t[i][e]=t[i][e]||o,n.addEventListener(e,function(n){t[i][e].call(this,n)})}),e.forEach(function(e){var o=n.getAttribute("b-"+e);o&&n.addEventListener(e,function(n){"function"==typeof t[o]&&t[o].call(this,n)})})}},removeNode:function(t,n,e){if(1===e.nodeType&&e.hasAttribute("b-name")){var o=e.getAttribute("b-name"),r=t[o]||n[o];funcs.util.mutable(r,"self"),r.self=r.self.filter(function(t){return!e.isSameNode(t)}),funcs.util.immutable(r,"self")}},addEvents:function(t){var n=this;t.observe=this.observe(t,function(e){var o,r=e.addedNodes,i=e.removedNodes,c={current:t.routes[t.view.current].state,old:t.view.old?t.routes[t.view.old].state:null};for(o=0;o<i.length;o++)n.removeNode(c.current,c.old,i[o]);for(o=0;o<r.length;o++)n.addEventsToNode(c.current,r[o])})}},funcs.routes={add:function(t,n,e,o){if(o.routes[t])throw"Error. Route with the name '"+t+"' already exists.";o.routes[t]={name:t,url:{html:n,script:e},content:{html:null},state:{}};var r=o.routes[t].state;funcs.util.createScope(o,r,o.routes)},deploy:function(t,n,e){var o=t.routes[n];if(!o)throw"Error. Route with the name '"+n+"' does not exist.";return funcs.hash["public"].set.view(n),funcs.load.page(t,o,function(t){console.log("loaded route '"+n+"'!"),e&&e()}),this}},funcs.transition={clonePage:function(t){t.copy&&(t.copy.parentNode.removeChild(t.copy),t.copy=null),t.copy=t.container.cloneNode(!0),t.copy.id="",t.copy.className=""},applyStyling:function(){},hideContainer:function(t){t.container.style.display="none"},appendCopy:function(t){var n=t.container.parentNode;n.insertBefore(t.copy,t.container.nextSibling)},callback:{set:function(t,n){n.transition=t},after:function(t){t.copy&&(t.copy.parentNode.removeChild(t.copy),t.copy=null),"none"==t.container.style.display&&(t.container.style.display="block"),t.animation.inProgress=!1}},before:function(t,n){this.clonePage(t),this.hideContainer(t),this.appendCopy(t)}},funcs.util={immutable:function(t,n,e){var o={writable:!1,configurable:!0};return e&&(o.value=e),Object.defineProperty(t,n,o),this},mutable:function(t,n){Object.defineProperty(t,n,{writable:!0})},createScopeKey:function(t,n){var e=funcs.util.immutable;t[n]||(t[n]={},e(t[n],"data",{}),e(t[n],"self",[]))},createScope:function(t,n,e){var o=funcs.util.immutable;o(n,"data",{}),o(n,"event",{}),o(n.event,"add",function(t,n,e){if(this[t]||(this[t]={}),"object"==typeof n)for(var o in n)this[t][o]=n[o];else this[t][n]=e}.bind(n)),o(n,"get",function(t){return n[t]?n[t]:(funcs.util.createScopeKey(n,t),console.warn("Error. This property with name '"+t+"' doesn't exist yet."),n[t])}),o(n.data,"prop",function(t,e,o){return n[t]||funcs.util.createScopeKey(n,t),n[t].data[e]=o,n[t].data[e]}),o(n.data,"transfer",function(e,o){var r=n.data[e];if("undefined"==typeof r||null===r)throw"Error. Data associated with key '"+e+"' does not exist.";if(!t.routes[o])throw"Error. View with the name '"+name+"' does not exist.";t.routes[o].state.data[e]=r})}},funcs.view={"new":function(t,n){t!==n.view.current&&null!==n.view.current&&n.routes[t]?(n.view.old=n.view.current,n.view.current=t,n.animation.inProgress=!0,funcs.hash["public"].set.view(t),funcs.transition.before(n),funcs.routes.deploy(n,t,function(){n.transition?n.transition.call(null,funcs.transition.callback.after.bind(null,n),{old:n.copy,"new":n.container},{"new":n.view.current,old:n.view.old}):funcs.transition.callback.after(n)})):t!==n.view.current&&n.routes[t]?(n.view.old=n.view.current,n.view.current=t,n.animation.inProgress=!0,funcs.routes.deploy(n,t,function(){funcs.transition.callback.after(n)})):n.routes[t]?t===n.view.current:console.warn("Error. The route '"+t+"' does not exist.")}};var RouteConfig=function(t){"use strict";var n={script:null,routes:{},config:{cache:!0},container:null,copy:null,view:{current:null,old:null},animation:{inProgress:!1},observer:null,_prototype:e};funcs.init(n,t);var e={add:function(t,e,o){return funcs.routes.add(t,e,o,n),this},deploy:function(t){return funcs.view["new"](t,n),this},config:function(t){funcs.config(t,n)},hash:funcs.hash["public"],transition:function(t){funcs.transition.callback.set(t,n)},controller:function(t){funcs.controller.scope(t,n)}};return e};