var funcs={};funcs.ajax=function(t,e,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?e.success(o.responseText):400==o.status?e.error(o.responseText,{error:400}):e.error(o.responseText,{error:"unknown"}))},n===!1&&(t+="?t="+(new Date).getTime()),o.open("GET",t,!0),o.send()},funcs.config=function(t,e){for(var n in t)t.hasOwnProperty(n)&&"undefined"!=typeof e.config[n]?e.config[n]=t[n]:console.warn("Warning. Cannot set new property '"+n+"' to config.");return this.proto},funcs.controller={scope:function(t,e){var n=e.routes[e.view.current].state;t(n,n.data,e.container)}},funcs.DOM={append:function(t,e){e.appendChild(t)},prepend:function(t,e){e.insertBefore(t,e.firstChild)},after:function(t,e){e.parentNode.insertBefore(t,e.nextSibling)},before:function(t,e){e.parentNode.insertBefore(t,e)},remove:function(t){t.parentNode.removeChild(t)},fillWithObjectProperties:function(t,e){for(var n,o,r=t.querySelectorAll("[b-obj]"),i=0;i<r.length;i++)n=r[i].getAttribute("b-obj"),o=funcs.util.dotToObject(e,n),r[i].innerHTML=o;return t},parentAndChildren:function(t){var e=[t];if(t.querySelectorAll)for(var n=t.querySelectorAll("*"),o=0;o<n.length;o++)e.push(n[o]);return e}},funcs.hash={"public":{get:function(){var t=window.location.hash.substr(2),e=t.match(/^[\w_-]+/),n=t.replace(/^[\w_-]+\?{0,}/,""),o={};return n.length>0&&(n=n.split(/&/g).map(function(t){return t.split(/=/g)}),o={},n.forEach(function(t){o[t[0]]=t[1]})),!!e&&{view:e[0],get:o}},set:{view:function(t){var e=funcs.hash["public"].get(),n=funcs.hash["private"].concatGet(e.get);e?window.location.hash="/"+t+(n?"?"+n:""):window.location.hash="/"+t},get:function(t){var e=funcs.hash["public"].get(),n=funcs.hash["private"].concatGet(t);if(!e)throw"Error. No view currently set.";window.location.hash="/"+e.view+(n?"?"+n:"")}}},"private":{concatGet:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push([n,t[n]]);return e.map(function(t){return t.join("=")}).join("&")}}},funcs.init=function(t,e){window.onhashchange=function(){var e=this.hash["public"].get();this.view["new"](e.view,t)}.bind(this),t.container="string"==typeof e?document.querySelectorAll(e)[0]:e,this.mutation.addEvents(t)},funcs.load={html:function(t,e,n){funcs.ajax(t,{success:function(t){e(t)},error:function(t,n){throw e(t),n}},n)},script:function(t,e,n){t.script&&document.body.removeChild(t.script),t.script=document.createElement("script"),t.script.onload=function(){n()},t.script.src=e,document.body.appendChild(t.script)},page:function(t,e,n){var o={html:!1,script:!1},r=function(){this.script(t,e.url.script,function(){o.script=!0,n()})}.bind(this);e.content.html&&t.config.cache?(o.html=!0,t.container.innerHTML=e.content.html,r()):this.html(e.url.html,function(n){o.html=!0,e.content.html=n,t.container.innerHTML=e.content.html,r()},t.config.cache)}},funcs.mutation={observe:function(t,e){var n=new MutationObserver(function(t){t.forEach(function(t){"childList"==t.type&&e(t)})}),o={attributes:!0,childList:!0,characterData:!0,subtree:!0};return n.observe(t.container,o),n},addEventsToNode:function(t,e){var n=["click","input","mousemove"],o=function(){},r=e.getAttribute("b-events"),i=e.getAttribute("b-name");i&&(funcs.scope.create.key(t,i),t[i].self.push(e),r&&r.split(/,/).forEach(function(n){t[i][n]=t[i][n]||o,e.addEventListener(n,function(e){t[i][n].call(this,e)})})),n.forEach(function(n){var o=e.getAttribute("b-"+n);o&&e.addEventListener(n,function(e){"function"==typeof t[o]&&t[o].call(this,e)})})},addRepeatToNode:function(t,e){var n=e.getAttribute("b-repeat");e.getAttribute("b-obj");e.removeAttribute("b-repeat"),funcs.util.immutable(t.data.repeat,n,{node:e.cloneNode(!0),list:[],meta:{prev:e.previousSibling,parent:e.parentNode}}),funcs.DOM.remove(e)},removeNode:function(t,e,n){if(1===n.nodeType&&n.hasAttribute("b-name")){var o=n.getAttribute("b-name"),r=t[o]||e[o];funcs.util.mutable(r,"self"),r.self=r.self.filter(function(t){return!n.isSameNode(t)}),funcs.util.immutable(r,"self")}},addEvents:function(t){var e=this,n=function(t,n){var o=funcs.DOM.parentAndChildren(n);o.forEach(function(n){1===n.nodeType&&(e.addEventsToNode(t.current,n),n.hasAttribute("b-repeat")&&e.addRepeatToNode(t.current,n))})};t.observe=this.observe(t,function(o){var r,i=o.addedNodes,c=o.removedNodes,a={current:t.routes[t.view.current].state,old:t.view.old?t.routes[t.view.old].state:null};for(r=0;r<c.length;r++)e.removeNode(a.current,a.old,c[r]);for(r=0;r<i.length;r++)n(a,i[r])})}},funcs.routes={add:function(t,e,n,o){if(o.routes[t])throw"Error. Route with the name '"+t+"' already exists.";o.routes[t]={name:t,url:{html:e,script:n},content:{html:null},state:{}};var r=o.routes[t].state;funcs.scope.create.scope(o,r,o.routes)},deploy:function(t,e,n){var o=t.routes[e];if(!o)throw"Error. Route with the name '"+e+"' does not exist.";return funcs.hash["public"].set.view(e),funcs.load.page(t,o,function(t){console.log("loaded route '"+e+"'!"),n&&n()}),this}},funcs.scope={create:{key:function(t,e){var n=funcs.util.immutable;t[e]||(t[e]={},n(t[e],"data",{}),n(t[e],"self",[]))},scope:function(t,e,n){var o=funcs.util.immutable;o(e,"data",{}),o(e,"get",function(t){return e[t]?e[t]:(funcs.scope.create.key(e,t),console.warn("Error. This property with name '"+t+"' doesn't exist yet."),e[t])}),o(e,"event",{}),funcs.scope.repeat(e),o(e.event,"add",function(t,e,n){if(this[t]||(this[t]={}),"object"==typeof e)for(var o in e)this[t][o]=e[o];else this[t][e]=n}.bind(e)),o(e.data,"prop",function(t,n,o){return e[t]||(funcs.scope.create.key(e,t),console.warn("The property with name '"+t+"' doesn't exist yet, but was just created.")),e[t].data[n]=o,e[t].data[n]}),o(e.data,"transfer",function(n,o){var r=e.data[n];if("undefined"==typeof r||null===r)throw"Error. Data associated with key '"+n+"' does not exist.";if(!t.routes[o])throw"Error. View with the name '"+name+"' does not exist.";t.routes[o].state.data[n]=r}),o(e.data,"repeat",{})}}},funcs.scope.repeat=function(t){var e=funcs.util.immutable;e(t,"repeat",function(e){if(t.data.repeat[e]){var n=t.data.repeat[e],o=n.node,r={generateID:function(){return Math.round(1e11*Math.random()).toString(36)+"_"+(new Date).getTime()},processNode:function(t,e){return t=t.cloneNode(!0),funcs.DOM.fillWithObjectProperties(t,e),t},processObject:function(t,e){return t.__meta={node:e,removed:!1,id:this.generateID()},e.setAttribute("b-id",t.__meta.id),t},validSibling:function(t){var e,o=!1;return n.list[t]?e=n.list[t].__meta.node:n.list[n.list.length-1]?e=n.list[n.list.length-1].__meta.node:n.list.meta.prev?e=n.list.meta.prev:(o=!0,e=n.list.meta.parent),{node:e,parent:o}},procedural:function(t,e){return t=this.processNode(t,e),e=this.processObject(e,t),{node:t,object:e}},prepend:function(t,e){n.list.unshift(e),n.meta.prev?funcs.DOM.after(t,n.meta.prev):funcs.DOM.prepend(t,n.meta.parent)},push:function(t,e){var o=n.list[n.list.length-1];console.log(o,n.meta),o?funcs.DOM.after(t,o.__meta.node):n.meta.prev?funcs.DOM.after(t,n.meta.prev):funcs.DOM.append(t,n.meta.parent),n.list.push(e)},at:function(t,e,o){var r=n.list[o];r?(n.list.splice(o,0,t),funcs.DOM.before(t,n.list[o+1].__meta.node)):(n.list.push(e),this.push(t,e),console.warn("Error. No node with index '"+o+"'. Node pushed instead."))}};return{unshift:function(t){var e=r.procedural(o,t);return r.prepend(e.node,e.object),this},at:function(t,e){var n=r.procedural(o,t);return r.at(n.node,n.object,e),this},push:function(t){var e=r.procedural(o,t);return r.push(e.node,e.object),this},filter:function(t){return n.list.forEach(function(e){t(e)===!1&&(e.__meta.removed=!0)}),n.list=n.list.filter(function(t){return!t.__meta.removed||(funcs.DOM.remove(t.__meta.node),!1)}),this},remove:function(t){"object"==typeof t&&(t=t.getAttribute("b-id")),this.filter(function(e){return e.__meta.id!==t})}}}console.warn("Error. Repeat associated with key '"+e+"' does not exist yet.")})},funcs.transition={clonePage:function(t){t.copy&&(t.copy.parentNode.removeChild(t.copy),t.copy=null),t.copy=t.container.cloneNode(!0),t.copy.id="",t.copy.className=""},applyStyling:function(){},hideContainer:function(t){t.container.style.display="none"},appendCopy:function(t){var e=t.container.parentNode;e.insertBefore(t.copy,t.container.nextSibling)},callback:{set:function(t,e){e.transition=t},after:function(t){t.copy&&(t.copy.parentNode.removeChild(t.copy),t.copy=null),"none"==t.container.style.display&&(t.container.style.display="block"),t.animation.inProgress=!1}},before:function(t,e){this.clonePage(t),this.hideContainer(t),this.appendCopy(t)}},funcs.util={immutable:function(t,e,n){var o={writable:!1,configurable:!0};return n&&(o.value=n),Object.defineProperty(t,e,o),this},mutable:function(t,e){Object.defineProperty(t,e,{writable:!0})},dotToObject:function(t,e){return e=e.split(/\./),e.forEach(function(e){t[e]?t=t[e]:console.warn("Cannot find property '"+e+"' of object in dot notation.")}),"object"!=typeof t?t:""}},funcs.view={"new":function(t,e){t!==e.view.current&&null!==e.view.current&&e.routes[t]?(e.view.old=e.view.current,e.view.current=t,e.animation.inProgress=!0,funcs.hash["public"].set.view(t),funcs.transition.before(e),funcs.routes.deploy(e,t,function(){e.transition?e.transition.call(null,funcs.transition.callback.after.bind(null,e),{old:e.copy,"new":e.container},{"new":e.view.current,old:e.view.old}):funcs.transition.callback.after(e)})):t!==e.view.current&&e.routes[t]?(e.view.old=e.view.current,e.view.current=t,e.animation.inProgress=!0,funcs.routes.deploy(e,t,function(){funcs.transition.callback.after(e)})):e.routes[t]?t===e.view.current:console.warn("Error. The route '"+t+"' does not exist.")}};var RouteConfig=function(t){"use strict";var e={script:null,routes:{},config:{cache:!0},container:null,copy:null,view:{current:null,old:null},animation:{inProgress:!1},observer:null,_prototype:n};funcs.init(e,t);var n={add:function(t,n,o){return funcs.routes.add(t,n,o,e),this},deploy:function(t){return funcs.view["new"](t,e),this},config:function(t){funcs.config(t,e)},hash:funcs.hash["public"],transition:function(t){funcs.transition.callback.set(t,e)},controller:function(t){funcs.controller.scope(t,e)}};return n};